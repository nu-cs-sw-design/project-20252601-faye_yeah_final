@startuml
skinparam classAttributeIconSize 0
hide empty members

package "Domain" {
  enum CardType {
    NOPE
    DEFUSE
    ATTACK
    SHUFFLE
    SKIP
    SEE_THE_FUTURE
    CAT_ONE
    CAT_TWO
    CAT_THREE
    CAT_FOUR
    EXPLODING_KITTEN
    STREAKING_KITTEN
    SWAP_TOP_AND_BOTTOM
    GARBAGE_COLLECTION
    CURSE_OF_THE_CAT_BUTT
    ALTER_THE_FUTURE
    CATOMIC_BOMB
    SUPER_SKIP
    MARK
    IMPLODING_KITTEN
    REVERSE
    FERAL_CAT
    TARGETED_ATTACK
    DRAW_FROM_THE_BOTTOM
  }

  class Card {
    - cardType: CardType
    - isMarked: boolean
    - isFacedUp: boolean
    - useEffect: CardEffect
    - drawTrigger: DrawTrigger
    + Card(cardType: CardType, useEffect: CardEffect, drawTrigger: DrawTrigger)
    + getCardType(): CardType
    + executeUseEffect(game: Game, player: Player, input: InputProvider, output: OutputProvider): EffectResult
    + executeDrawTrigger(game: Game, player: Player, input: InputProvider, output: OutputProvider): DrawResult
    + markCard(): void
    + setFacedUp(): void
    + checkIfMarked(): boolean
    + checkIfFacedUp(): boolean
  }

  class EffectResult {
    - success: boolean
    - endsTurn: boolean
    - message: String
    - cancelled: boolean
    + isSuccess(): boolean
    + shouldEndTurn(): boolean
    + getMessage(): String
    + isCancelled(): boolean
  }

  class DrawResult {
    - survived: boolean
    - message: String
    - shouldKeepCard: boolean
    + didSurvive(): boolean
    + getMessage(): String
    + shouldKeepCard(): boolean
  }
}

package "Card Effects" {
  interface CardEffect {
    + execute(game: Game, player: Player, input: InputProvider, output: OutputProvider): EffectResult
    + canExecute(game: Game, player: Player): boolean
  }

  interface NopableEffect {
  }

  class ShuffleEffect {
    - shuffleStrategy: ShuffleStrategy
    + ShuffleEffect(shuffleStrategy: ShuffleStrategy)
    + execute(game: Game, player: Player, input: InputProvider, output: OutputProvider): EffectResult
    + canExecute(game: Game, player: Player): boolean
  }

  class SeeTheFutureEffect {
    - cardsToReveal: int
    + SeeTheFutureEffect(cardsToReveal: int)
    + execute(game: Game, player: Player, input: InputProvider, output: OutputProvider): EffectResult
    + canExecute(game: Game, player: Player): boolean
  }

  class AlterTheFutureEffect {
    - cardsToAlter: int
    + AlterTheFutureEffect(cardsToAlter: int)
    + execute(game: Game, player: Player, input: InputProvider, output: OutputProvider): EffectResult
    + canExecute(game: Game, player: Player): boolean
  }

  class AttackEffect {
    - targeted: boolean
    + AttackEffect(targeted: boolean)
    + execute(game: Game, player: Player, input: InputProvider, output: OutputProvider): EffectResult
    + canExecute(game: Game, player: Player): boolean
  }

  class SkipEffect {
    - superSkip: boolean
    + SkipEffect(superSkip: boolean)
    + execute(game: Game, player: Player, input: InputProvider, output: OutputProvider): EffectResult
    + canExecute(game: Game, player: Player): boolean
  }

  class ReverseEffect {
    + execute(game: Game, player: Player, input: InputProvider, output: OutputProvider): EffectResult
    + canExecute(game: Game, player: Player): boolean
  }

  class CatomicBombEffect {
    + execute(game: Game, player: Player, input: InputProvider, output: OutputProvider): EffectResult
    + canExecute(game: Game, player: Player): boolean
  }

  class DrawFromBottomEffect {
    + execute(game: Game, player: Player, input: InputProvider, output: OutputProvider): EffectResult
    + canExecute(game: Game, player: Player): boolean
  }

  class NoEffect {
    + execute(game: Game, player: Player, input: InputProvider, output: OutputProvider): EffectResult
    + canExecute(game: Game, player: Player): boolean
  }

  class NOPEInterceptor {
    - wrappedEffect: CardEffect
    + NOPEInterceptor(wrappedEffect: NopableEffect)
    + execute(game: Game, player: Player, input: InputProvider, output: OutputProvider): EffectResult
    + canExecute(game: Game, player: Player): boolean
  }
}

package "Draw Triggers" {
  interface DrawTrigger {
    + onDraw(game: Game, player: Player, input: InputProvider, output: OutputProvider): DrawResult
  }

  class ExplodingKittenTrigger {
    + onDraw(game: Game, player: Player, input: InputProvider, output: OutputProvider): DrawResult
  }

  class ImplodingKittenTrigger {
    + onDraw(game: Game, player: Player, input: InputProvider, output: OutputProvider): DrawResult
  }

  class NormalDrawTrigger {
    + onDraw(game: Game, player: Player, input: InputProvider, output: OutputProvider): DrawResult
  }

  class StreakingKittenTrigger {
    + onDraw(game: Game, player: Player, input: InputProvider, output: OutputProvider): DrawResult
  }
}

package "Shuffle Strategies" {
  interface ShuffleStrategy {
    + shuffle(deck: Deck): void
  }

  class FisherYatesShuffle {
    + shuffle(deck: Deck): void
  }

  class RiffleShuffle {
    + shuffle(deck: Deck): void
  }

  class PileShuffle {
    - numberOfPiles: int
    + PileShuffle(numberOfPiles: int)
    + shuffle(deck: Deck): void
  }
}

package "Factories" {
  class CardEffectFactory {
    - effectRegistry: Map<CardType, CardEffect>
    - shuffleStrategy: ShuffleStrategy
    + CardEffectFactory()
    + registerEffects(): void
    + getEffect(cardType: CardType): CardEffect
    + getTrigger(cardType: CardType): DrawTrigger
    + hasEffect(cardType: CardType): boolean
    + hasTrigger(cardType: CardType): boolean
  }

  class CardFactory {
    - effectFactory: CardEffectFactory
    + CardFactory(effectFactory: CardEffectFactory)
    + createCard(cardType: CardType): Card
  }
}

package "IO Abstractions" {
  interface InputProvider {
    + readInteger(message: String, min: int, max: int): int
    + readYesNo(message: String): boolean
  }

  interface OutputProvider {
    + display(message: String): void
  }

  class ConsoleInput {
    - scanner: java.util.Scanner
    + ConsoleInput(scanner: java.util.Scanner)
    + readInteger(message: String, min: int, max: int): int
    + readYesNo(message: String): boolean
  }

  class ConsoleOutput {
    + display(message: String): void
  }
}

Card --> CardType
Card --> CardEffect
Card --> DrawTrigger

CardEffect <|.. ShuffleEffect
CardEffect <|.. SeeTheFutureEffect
CardEffect <|.. AlterTheFutureEffect
CardEffect <|.. AttackEffect
CardEffect <|.. SkipEffect
CardEffect <|.. ReverseEffect
CardEffect <|.. CatomicBombEffect
CardEffect <|.. DrawFromBottomEffect
CardEffect <|.. NoEffect
CardEffect <|.. NOPEInterceptor

CardEffect <|.. NopableEffect

DrawTrigger <|.. ExplodingKittenTrigger
DrawTrigger <|.. ImplodingKittenTrigger
DrawTrigger <|.. NormalDrawTrigger
DrawTrigger <|.. StreakingKittenTrigger

ShuffleStrategy <|.. FisherYatesShuffle
ShuffleStrategy <|.. RiffleShuffle
ShuffleStrategy <|.. PileShuffle
ShuffleEffect --> ShuffleStrategy

NopableEffect <|.. AttackEffect

NOPEInterceptor --> NopableEffect : wraps
CardEffectFactory --> CardEffect
CardEffectFactory --> DrawTrigger
CardFactory --> Card
CardFactory --> CardEffectFactory

InputProvider <|.. ConsoleInput
OutputProvider <|.. ConsoleOutput

ExplodingKittenTrigger ..> DrawResult
ImplodingKittenTrigger ..> DrawResult
NormalDrawTrigger ..> DrawResult
StreakingKittenTrigger ..> DrawResult


@enduml

