@startuml ThreeLayerArchitecture

package "Presentation Layer" {
  interface GameView {
    + void chooseLanguage()
    + void showMessage(String messageKey, Object... args)
    + void displayGameState(GameStateDto state)
    + PlayerAction promptAction(List<PlayerAction> allowedActions)
  }

  class GameUI implements GameView {
    - ResourceBundle messages
    - Scanner scanner
    - Locale locale
    - MessageFormat messageFormatter
    + GameUI(ResourceBundle messages, Scanner scanner, Locale locale)
    + void chooseLanguage()
    + void showMessage(String messageKey, Object... args)
    + void displayGameState(GameStateDto state)
    + PlayerAction promptAction(List<PlayerAction> allowedActions)
  }

  class GameController {
    - GameUseCase gameService
    - GameView view
    - GameStateDto currentState
    + GameController(GameUseCase gameService, GameView view)
    + void start()
    - void handlePlayerAction(PlayerAction action)
    - void renderState(GameStateDto state)
  }

  class Main {
    + {static} void main(String[] args)
  }
}

package "Domain Layer" {
  class Card {
    - CardType cardType
    - boolean isMarked
    - boolean isFacedUp
    + Card(CardType cardType)
    + CardType getCardType()
    + void markCard()
    + boolean checkIfMarked()
    + void setFacedUp()
    + boolean checkIfFacedUp()
  }

  enum CardType {
    NOPE
    DEFUSE
    ATTACK
    SHUFFLE
    SKIP
    SEE_THE_FUTURE
    CAT_ONE
    CAT_TWO
    CAT_THREE
    CAT_FOUR
    EXPLODING_KITTEN
    STREAKING_KITTEN
    SWAP_TOP_AND_BOTTOM
    GARBAGE_COLLECTION
    CURSE_OF_THE_CAT_BUTT
    ALTER_THE_FUTURE
    CATOMIC_BOMB
    SUPER_SKIP
    MARK
    IMPLODING_KITTEN
    REVERSE
    FERAL_CAT
    TARGETED_ATTACK
    DRAW_FROM_THE_BOTTOM
    - GameType gameType
    + CardType(GameType gameType)
  }

  enum GameType {
    NONE
    EXPLODING_KITTENS
    STREAKING_KITTENS
    IMPLODING_KITTENS
  }

  enum ActionType {
    CONFIGURE_GAME
    DRAW
    PLAY_CARD
    DEFUSE
    SKIP
    END_TURN
  }

  class PlayerAction {
    - ActionType actionType
    - int actingPlayerIndex
    - Map<String, Object> metadata
    + PlayerAction(ActionType actionType, int actingPlayerIndex, Map<String, Object> metadata)
    + ActionType getActionType()
    + int getActingPlayerIndex()
    + Map<String, Object> getMetadata()
  }

  class GameConfig {
    - int numberOfPlayers
    - GameType gameType
    - Random rand
    - Instantiator instantiator
    + GameConfig(int numberOfPlayers, GameType gameType, Random rand, Instantiator instantiator)
    + int getNumberOfPlayers()
    + GameType getGameType()
    + Random getRandom()
    + Instantiator getInstantiator()
  }

  class PlayerPublicInfo {
    - int playerID
    - int handSize
    - boolean isCursed
    - boolean isDead
    + PlayerPublicInfo(int playerID, int handSize, boolean isCursed, boolean isDead)
    + int getPlayerID()
    + int getHandSize()
    + boolean getIsCursed()
    + boolean getIsDead()
  }

  class GameStateDto {
    - List<PlayerPublicInfo> players
    - int deckSize
    - int currentPlayerTurn
    - boolean attacked
    + GameStateDto(List<PlayerPublicInfo> players, int deckSize, int currentPlayerTurn, boolean attacked)
    + List<PlayerPublicInfo> getPlayers()
    + int getDeckSize()
    + int getCurrentPlayerTurn()
    + boolean getAttacked()
  }

  class Deck {
    - List<Card> deck
    - Random rand
    - GameType gameType
    - int numberOfPlayers
    - int maxDeckSize
    - Instantiator instantiator
    + Deck(List<Card> deck, Random rand, GameType gameType, int numberOfPlayers, int maxDeckSize, Instantiator instantiator)
    + int getDeckSize()
    + Card getCardAtIndex(int index)
    + void initializeDeck()
    + void shuffleDeck()
    + void insertCard(CardType cardType, int numberOfCards, boolean bottom)
    + Card drawCard()
    + Card drawCardFromBottom()
    + void setNumberOfPlayers(int numberOfPlayers)
    + void chooseGameType(GameType gameType)
    + int removeBombs()
    + void insertExplodingKittenAtIndex(int indexToInsert)
    + void insertImplodingKittenAtIndex(int indexToInsert, Card card)
    # CardType getCardTypeAtIndex(int index)
    + void reorderDeckCards(int[] newOrderIndices, List<Card> cardsToReorder)
    - boolean addedOutOfBounds(int numberOfCards)
    - boolean checkIfExplodingKitten(int index)
    - boolean checkIfIndexOutOfRange(int index)
  }

  class Player {
    - int playerID
    - List<Card> hand
    - boolean isDead
    - Random rand
    - boolean isCursed
    + Player(int playerID, Instantiator instantiator)
    + int getPlayerID()
    + void addDefuse(Card defuse)
    + void addCardToHand(Card card)
    + boolean hasCard(CardType cardType)
    + int getHandSize()
    + Card getCardAt(int index)
    + int getIndexOfCard(CardType cardType)
    + CardType removeCardFromHand(int index)
    + void shuffleHand()
    + int checkNumberOfCardsInHand(CardType cardType)
    + boolean getIsDead()
    + void setIsDead()
    + boolean getIsCursed()
    + void setCursed(boolean isCursed)
  }

  class Game {
    - int numberOfPlayers
    - GameType gameType
    - Deck deck
    - Player[] players
    - Random rand
    - int currentPlayerTurn
    - int currentPlayerNumberOfTurns
    - boolean isReversed
    - List<Integer> attackQueue
    - int attackCounter
    - int numberOfAttacks
    - int[] turnTracker
    - boolean attacked
    + Game(int numberOfPlayers, GameType gameType, Deck deck, Player[] players, Random rand, List<Integer> attackQueue, int[] turnTracker)
    + void swapTopAndBottom()
    + Card stealRandomCard(int playerToStealFrom)
    + void stealTypeCard(CardType cardType, int playerToStealFrom)
    + void startAttackPhase()
    + void playAttack()
    + void playTargetedAttack(int attackedPlayerIndex)
    + boolean playExplodingKitten(int playerIndex)
    + void playImplodingKitten()
    + void playDefuse(int idxToInsertExplodingKitten, int playerIndex)
    + Card drawFromBottom()
    + void playCatomicBomb()
    + void setNumberOfPlayers(int numberOfPlayers)
    + void playReverse()
    + void retrieveGameMode(GameType gameType)
    + Player selectRandomPlayer()
    + void playShuffle(int numberOfShuffles)
    + int playSkip(boolean superSkip)
    + void playGarbageCollection(CardType cardToDiscard)
    + Deck getDeck()
    + void incrementPlayerTurn()
    + void incrementAttackCounter()
    + void setAttackCounter(int playerIndex)
    ~ GameType getGameTypeForTesting()
    + GameType getGameType()
    + Player getPlayerAtIndex(int playerIndex)
    + void addAttacks()
    + void playMark(int playerIndex, int cardIndex)
    + void addAttackQueue(int attack)
    + int removeAttackQueue()
    + boolean isAttackQueueEmpty()
    + void setPlayerNumberOfTurns()
    + int getPlayerTurn()
    + int getNumberOfPlayers()
    + int checkNumberOfAlivePlayers()
    + void setCurrentPlayerNumberOfTurns(int numberOfTurns)
    + void decrementNumberOfTurns()
    + int getNumberOfTurns()
    + int getDeckSize()
    + Card drawCard()
    + Card getCardAtIndex(int cardIndex)
    + void removeCardFromHand(int playerIndex, CardType cardType)
    + int getIndexOfCardFromHand(int playerIndex, CardType cardType)
    + void addCardToHand(Card card)
    + boolean checkIfPlayerDead(int playerIndex)
    + boolean checkIfPlayerHasCard(int playerIndex, CardType cardType)
    + CardType getCardType(int playerIndex, int cardIndex)
    + int getHandSize(int playerIndex)
    + CardType getDeckCardType(int deckIndex)
    + boolean getIsReversed()
    # void setCurrentPlayerTurn(int turn)
    - boolean matchingGameType(GameType gameType)
    - boolean checkCardOutOfBoundsIndexed(int cardIndex, int playerIndex)
    - boolean checkUserOutOfBounds(int userIndex)
    - boolean checkDeckHasOneCardOrLess()
    - boolean checkPlayerHandEmpty(Player player)
    - boolean checkInvalidNumberOfPlayers(int numPlayers)
    - boolean hasZeroPlayers()
    - boolean checkIfNumberOfTurnsOutOfBounds()
    - boolean checkIfNumberOfTurnsIsZero()
    + void setTurnToTargetedIndexIfAttackOccurred()
    + int getTurnCountOfPlayer(int playerIndex)
    + boolean getAttacked()
    + int getAttackCounter()
    + int getNumberOfAttacks()
    ~ void setNumberOfAttacks(int numberOfAttacks)
    ~ void setAttacked(boolean attacked)
  }

  interface GameUseCase {
    + GameStateDto startGame(GameConfig config)
    + GameStateDto execute(PlayerAction action)
    + boolean isGameOver()
  }

  class GameApplicationService implements GameUseCase {
    - GameFactory gameFactory
    - GameRepository gameRepository
    + GameApplicationService(GameFactory gameFactory, GameRepository gameRepository)
    + GameStateDto startGame(GameConfig config)
    + GameStateDto execute(PlayerAction action)
    + boolean isGameOver()
    - GameStateDto mapToDto(Game game)
  }

  class GameFactory {
    - Instantiator instantiator
    + GameFactory(Instantiator instantiator)
    + Game create(GameConfig config)
  }

  interface GameRepository {
    + void save(Game game)
    + Game get()
    + boolean exists()
  }
}

package "Data Source Layer" {
  class Instantiator {
    + Card createCard(CardType cardType)
    + Random createRandom()
    + ArrayList<Card> createCardList()
  }

  class InMemoryGameRepository implements GameRepository {
    - Game currentGame
    + InMemoryGameRepository()
    + void save(Game game)
    + Game get()
    + boolean exists()
  }
}

Card --> CardType
Deck --> GameType
Deck --> Card
Deck --> Instantiator
Deck ..> CardType
Deck ..> Random

Game --> GameType
Game --> Deck
Game --> Player
Game ..> CardType
Game ..> Card
Game ..> Random
Game ..> Instantiator

Player --> Card
Player --> Instantiator
Player ..> CardType
Player ..> Random
Player ..> ArrayList

PlayerAction --> ActionType
PlayerAction ..> Map
GameConfig --> GameType
GameConfig --> Instantiator
GameConfig --> Random
GameStateDto --> PlayerPublicInfo
GameStateDto ..> List

GameApplicationService --> GameFactory
GameApplicationService --> GameRepository
GameApplicationService --> Game
GameApplicationService ..> GameStateDto
GameApplicationService ..> PlayerAction
GameApplicationService ..> GameConfig

GameFactory --> Instantiator
GameFactory --> Game

GameRepository ..> Game
InMemoryGameRepository --> Game

GameUseCase ..> GameStateDto
GameUseCase ..> GameConfig
GameUseCase ..> PlayerAction

GameController --> GameUseCase
GameController --> GameView
GameController ..> PlayerAction
GameController ..> GameStateDto

GameView ..> GameStateDto
GameView ..> PlayerAction
GameView ..> List

GameUI ..> ResourceBundle
GameUI ..> Scanner
GameUI ..> Locale
GameUI ..> MessageFormat
GameUI ..> List
GameUI ..> PlayerAction
GameUI ..> GameStateDto

Main ..> Instantiator
Main ..> GameFactory
Main ..> InMemoryGameRepository
Main ..> GameApplicationService
Main ..> GameController
Main ..> GameUI
Main ..> GameUseCase
Main ..> GameConfig
Main ..> SecureRandom

@enduml