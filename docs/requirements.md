# Software Requirement Document

本文件聚焦于「启动游戏」以及四张核心卡牌（Exploding Kitten、Nope、Shuffle、Draw From Bottom）的主要用例，明确各自的触发条件、参与者、典型流程与异常流程。

## 用例 UC-01：启动游戏

- **主要参与者**：主持人（本地控制台玩家）
- **利益相关者与需求**：
  - 主持人希望通过控制台配置语言、游戏模式与玩家数量。
  - 系统需要初始化卡组、分发起始卡、移除并重新插入炸弹。
- **前置条件**：
  - 已启动应用，控制台可读写。
  - 依赖的资源文件（多语言字符串）可加载。
- **后置条件**：
  - `Game` 进入首个玩家回合，所有玩家各自持有初始手牌。
- **主成功场景**：
  1. 主持人选择语言（英语或韩语）。
  2. 主持人选择游戏模式（Exploding / Imploding / Streaking）。
  3. 主持人设置玩家人数（2–4）。
  4. 系统根据模式与人数初始化 `Deck`，发牌并插入炸弹。
  5. 系统提示首位玩家开始行动。
- **扩展**：
  - 1a. 语言选择无效：系统提示“Invalid choice”并重试。
  - 2a/3a. 模式或人数输入越界：系统提示错误并重试。

## 用例 UC-02：打出 Shuffle

- **主要参与者**：当前回合玩家
- **前置条件**：
  - 玩家手牌中至少有一张 `Shuffle`。
  - 当前回合尚未结束。
- **后置条件**：
  - 牌堆经过 Fisher-Yates 洗牌指定次数；玩家失去该 `Shuffle`。
- **主成功场景**：
  1. 玩家在手牌列表中选择 `Shuffle`。
  2. 系统询问洗牌次数（1–100）。
  3. 玩家输入次数，系统调用 `Deck.shuffleDeck()` 迭代执行。
  4. 系统确认洗牌完成，回合仍由当前玩家继续。
- **扩展**：
  - 2a. 次数 ≤0 或 >100：提示重新输入。
  - 3a. 其他玩家输入 Nope（参见 UC-03），若被否决则终止本次洗牌。

## 用例 UC-03：响应 Nope

- **主要参与者**：除当前施放者以外的任何存活玩家
- **前置条件**：
  - 任一动作（卡牌或组合）已声明且允许被 Nope。
  - 响应玩家手中有 `Nope`。
- **后置条件**：
  - 若所有层级 Nope 结果为取消：被否决动作不再生效。
  - 若被 No 的 Nope：恢复原动作或进入下一层 Nope 判定。
- **主成功场景**：
  1. 系统广播“某玩家可选择打出 Nope”。
  2. 响应玩家确认后移除 `Nope`，系统生成 `EffectResult.cancelled = true`。
  3. 若无更多 Nope，原动作视为取消。
- **扩展**：
  - 2a. 其他玩家继续链式 Nope：系统以栈形式追踪，最终由最后一次 No 决定是否恢复原动作。

## 用例 UC-04：抽到 Exploding Kitten

- **主要参与者**：当前抽牌玩家
- **前置条件**：
  - 玩家执行 `Game.drawCard()` 或被迫偷到炸弹。
- **后置条件**：
  - 若玩家无法或拒绝使用 Defuse：`Player.setIsDead()`；若使用 Defuse，则炸弹重新插回牌堆指定位置。
- **主成功场景**：
  1. 玩家抽到 Exploding Kitten，系统触发 `ExplodingKittenTrigger.onDraw()`。
  2. 若玩家持有 `Defuse`：
     - 系统提示将炸弹插回 0–N 的任意位置。
     - 玩家选择索引，系统在该索引插入炸弹，弃置一张 `Defuse`。
     - 触发结果 `DrawResult.survived = true`，回合继续。
  3. 若玩家无 `Defuse`：系统宣告玩家爆炸死亡，立即结束其回合。
- **扩展**：
  - 2a. 输入索引越界：提示错误并重试。
  - 2b. 玩家被诅咒（手牌隐藏）时，需先正确找出 Defuse，否则按 UI 逻辑继续处理。

## 用例 UC-05：Draw From Bottom

- **主要参与者**：当前回合玩家
- **前置条件**：
  - 玩家手牌中拥有 `Draw From Bottom`。
- **后置条件**：
  - 玩家从牌堆底部抽取一张牌（可能再次触发 UC-04）。
- **主成功场景**：
  1. 玩家选择打出 `Draw From Bottom`。
  2. 系统调用 `Deck.drawCardFromBottom()` 并自动加入手牌。
  3. 若抽到的是 Exploding Kitten，则进入 UC-04 的流程。
- **扩展**：
  - 2a. 牌堆为空：抛错 `DRAW_FROM_EMPTY_DECK_EXCEPTION` 并提示玩家重新选择动作。

---

通过上述用例列表，需求文档清晰覆盖了「启动游戏」及四张核心卡在不同阶段（使用、触发与链式取消）下的交互流程，可作为后续设计与实现验证的基线。



